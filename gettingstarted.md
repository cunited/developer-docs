# 開発プロセス概要

* メイン言語は PHP です。バージョン管理は Git でおこなっています。
* ローカルの Virtualbox 上で本番環境相当のサーバ環境を動かします(以下、VM環境)
* ソースコードの取得や編集は、ローカルのMac上でおこないます(以下、ホスト環境)
* ホスト環境のソースコードディレクトリは、VM環境の適切な位置にNFS syncされていますので、ソースコードを編集しながら動作確認できます。
* Redmineでチケットを作成し、チケット番号を付記した名称で feature branch を作成し、開発をおこないます。
* 開発が完了したら、テストが通ることを確認した上で、feature branch を origin に push し、「プルリク」と言いながら Redmine のチケットを誰かに渡してください。
* レビュー待ちの feature branch をレビューし、問題なければ master branch へマージし、リリースをおこないます。

# 用意するもの

* MacOS 10.8 以降(Winの方はすみません)
* Oracle VM Virtualbox .. https://www.virtualbox.org/wiki/Downloads からダウンロード＆インストールしておいてください
* Vagrant .. http://www.vagrantup.com/ からダウンロード＆インストールしておいてください(Versionによってハマることがあるので、適時 developer に確認しておいてください)
* Gitコマンド .. GUIがお好みなら適当なものをどうぞ
* SSH鍵ペア .. 鍵長は2048bit以上で作成してください
* HDD の空き 50GB 程度 .. 諸々データやら素材を入れるので、これくらいあると安心
* メールアドレス

# 事前準備

## developer 作業

* newcomer から SSH 公開鍵を受け取ってください。
* リポジトリサーバにアカウントを作成し、newcomer の公開鍵を配置してください。
* newcomerのメールアドレスでSlackのチームにinviteしてください。

## newcomer 作業

* ローカルの開発環境にアクセスするための hosts 設定をしてください。設定内容は別途支給されます。
* 業務上利用するリモートホストへ接続する際の ssh_config に、ForwardAgent yes 設定を入れてください。ホスト情報は別途支給されます。

# 開発環境セットアップ

* ホスト環境の適当なディレクトリにソースコードを clone します。
* clone したディレクトリ(以下、作業ディレクトリ)に cd し、vagrant up してください。途中で NFS 設定を行うために Mac のパスワードを聞かれるので、入力してください。
* 作業ディレクトリから cd chef-repo とし、knife solo prepare cytavm && knife solo cook cytavm としてください。(この処理は、多少時間がかかりますので、この間に別途支給する「サイタシステム概要」「開発ガイドライン」を読んでおいてください。)
* vagrant ssh で VM 環境に入り、いくつかの定義済み Capistrano タスクを実行します。このタスクは、データベースや CMS アップロードされている画像ファイルなどをできるだけ本番環境に近づけるために実行します。タスク名は別途支給されます。(この処理も、多少時間がかかりますので、上記のドキュメントを以下略)
* 作業ディレクトリの script/gittools 以下に、Git の pre-commit Hook スクリプトが配置されているので、.git/hooks/pre-commit としてコピーしておいてください。コミット時の整形やエラーチェックなどに使われます。
* ホスト環境から、所定の URL へアクセスし、サイタTOPページが表示されることを確認してください。
* TOPページが表示されていれば、セットアップ完了です。おめでとうございます！

# 日々の開発

* Redmine で自分に割り当てられているチケットがあれば、それを進めてください。
* 社内の(Yammer含む)コミュニケーションで、チケット化できそうなものがあれば作成してOKですが、要検討レベルのものであれば、Yammer や定例 Tech meeting で開発要件や適否について討議しましょう。
